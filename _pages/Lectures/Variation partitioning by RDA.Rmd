---
title: "Variation partitioning by RDA"
author: 
- "Pablo E. Guti√©rrez-Fonseca"
- "`r format(Sys.time(), '%d %B, %Y')`"
layout: default
permalink: /pages/Lectures/Introduction to R/
output: html_document
---
<br/>
<br/>

#### Primer paso: cargar las librerias que necesitas.
```{r, warning=FALSE, message=FALSE}
library(ggplot2)
library(dplyr)
library(vegan)
```

<br/>

#### Segundo paso: cargar los datos.
```{r}
species=read.csv("D:/Curriculum/07_ Cursos/Course_Multivariate_Stat_for_Ecological_Data/data/RDA_species.csv", header=T, row.names=NULL, sep=",")
env=read.csv("D:/Curriculum/07_ Cursos/Course_Multivariate_Stat_for_Ecological_Data/data/RDA_environmetal_standart.csv", header=T, row.names=NULL, sep=",")
```

<br/>

#### Remover la columna de sitos.
```{r}
species_1 <- select(species, -site)
env_1 <- select(env, -site)
```

<br/>

#### Transformar datos.
Hellinger es una transformacion recomendada por Legendre & Callagher (2001)
en datos de abundancia y con una respuesta lineal
```{r}
species.hel <- decostand(species_1, method = "hellinger")
```

<br/>

#### Vamos a construir los modelos: combinados e individuales
```{r}
partial_rda_all = rda(species.hel ~., data= env_1, scale=F)
partial_rda_env = rda(species.hel ~ temperature + oxygen + pH + conductivity, 
                      data= env_1, scale=F)
partial_rda_phy = rda(species.hel ~ plants + land_use + margin, 
                      data= env_1, scale=F)
partial_rda_season = rda(species.hel ~ season, data= env_1, scale=F)

```

<br/>

#### Ver los R2adj de cada uno
```{r}
RsquareAdj (partial_rda_all)
RsquareAdj (partial_rda_env)
RsquareAdj(partial_rda_phy)
RsquareAdj(partial_rda_season)
```

<br/>

#### Vamos a correr un RDA con las matrices (diferentes factores) separadas. 
```{r}
varp <- varpart(species.hel, ~ temperature + oxygen + pH + conductivity, 
                ~ plants + land_use + margin, ~season, data = env_1)
varp
```
Legendre (2008) [doi: 10.1093/jpe/rtm001] argued that "Negative values of Ra2 are interpreted as zeros; they correspond to cases where the explanatory variables explain less variation than random normal variables would."


<br/>

#### Plot the results
The plot shows the adjusted R2 values associated with each partition or for overlapping partitions.
```{r}
plot(varp, digits = 2, Xnames = c('Enviromental factors', 'Plants', "Season"), 
     bg = c('navy', 'tomato', "lightblue"))

## Show values for all partitions by putting 'cutoff' low enough:
#plot(varp, cutoff = -Inf, cex = 0.7, bg=2:5)
```

<br/>

#### Then we can test the significance of each individual component. 
```{r}

# significance of partition from Environment (physicochemical variables)
anova(rda(species.hel ~ temperature + oxygen + pH + conductivity + 
          Condition(plants + land_use + margin) +  
          Condition(season), data=env_1))

# Significance of partition from Physical characteristics
anova(rda(species.hel ~ plants + land_use + margin +
          Condition(temperature + oxygen + pH + conductivity) +  
          Condition(season), data=env_1))

# Significance of partition from Season
anova(rda(species.hel ~ season +
          Condition(plants + land_use + margin) +
          Condition(temperature + oxygen + pH + conductivity), 
          data=env_1))

```

Physicochemical and Physical characteriscs are all statistically significant in their contributions to Odonata community composition, even though the amount of variation explained by Physicochemistry is small. There was no statistically significant of season in Odonata composition independent of these other measured drivers.
